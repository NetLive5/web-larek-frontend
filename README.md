# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Типы данных

- **ILotItem**: Описывает один элемент продукта.
- **LotCategory**: Категории карточек.
- **IAppState**: Интерфейс, описывающий состояние приложения, включая каталог лотов, корзину, превью, информацию о заказе и состояние загрузки.
- **IOrderForm**: Интерфейс, описывающий форму для заполнения данных заказа, такие как электронная почта и номер телефона.
- **IOrder**: Интерфейс, расширяющий IOrderForm, описывающий заказ, включающий информацию о форме заказа и выбранных элементах.
- **FormErrors**: Интерфейс, представляющий объект, содержащий сообщения об ошибках для каждого поля в форме заказа.
- **IOrderResult**: Интерфейс, описывающий результат заказа, включая уникальный идентификатор заказа и стоимость заказа.

# Классы

## Класс Component

Базовый компонент, предоставляющий интерфейс для взаимодействия с пользователем.

Используется в классах `Page`, `Form`, `Modal`, `Tabs`, `Success` для создания компонентов страницы.

### Основные методы и свойства:

- `constructor`: Конструктор класса принимает контейнерный элемент HTMLElement, в котором будет отображаться компонент.
- `toggleClass`: Метод для переключения класса у элемента.
- `setText`: Метод для установки текстового содержимого элемента.
- `setDisabled`: Метод для установки состояния блокировки элемента.
- `setHidden` и `setVisible`: Методы для скрытия и отображения элемента соответственно.
- `setImage`: Метод для установки изображения элемента.
- `render`: Метод, который используется для отрисовки компонента. xВозвращает корневой элемент DOM компонента.

---

## Класс Page extends Component

Позволяет управлять отображением элементов на странице и взаимодействовать с событиями, происходящими на странице. Он использует базовый класс Component для обеспечения удобства работы с DOM-элементами и отрисовки компонентов.

### Основные методы и свойства:

#### Свойства:

- `_counter`: Счетчик
- `_catalog`: Каталог
- `_wrapper`: Обертку страницы
- `_basket`: Корзину

#### Методы:

- `set counter`: Устанавливает счетчик
- `set catalog`: Заменяет содержимое каталога на странице новыми элементами
- `set locked`: Устанавливает или убирает класс блокировки

---

## Класс Basket extends Component

Класс `Basket` описывает корзину товаров. Он предоставляет методы для отображения списка товаров, установки общей цены и отключения кнопки оформления заказа.

#### Свойства

- `_list`: Список товаров в корзине.
- `_price`: Общая цена товаров в корзине.
- `_button`: Кнопка оформления заказа.

### Методы

- `set price(price: number)`: Устанавливает общую цену товаров в корзине.
- `set list(items: HTMLElement[])`: Устанавливает список товаров в корзине и обновляет состояние кнопки оформления заказа.
- `disableButton()`: Отключает кнопку оформления заказа.
- `refreshIndices()`: Обновляет индексы товаров после удаления из корзины.

## Класс CatalogItemsBasket extends Component

Класс `CatalogItemsBasket` представляет отдельный товар в корзине. Он позволяет отображать название товара, его индекс, цену и предоставляет возможность удаления товара из корзины.

#### Свойства

- `_title`: Название товара.
- `_index`: Индекс товара.
- `_price`: Цена товара.
- `_button`: Кнопка удаления товара из корзины.

#### Методы

- `set title(value: string)`: Устанавливает название товара.
- `set index(value: number)`: Устанавливает индекс товара.
- `set price(value: number)`: Устанавливает цену товара.

---

## Класс Card extends Component

Представляет карточку товара с изображением, названием, описанием, категорией, ценой и кнопкой действия. Он предоставляет методы для установки и получения данных карточки, а также для управления их отображением.

#### Свойства:

- `id`: Идентификатор карточки
- `title`: Название товара
- `description`: Описание товара
- `image`: Изображение товара
- `category`: Категория товара
- `price`: Цена товара

#### Методы:

- `set id`: Устанавливает ID карточки
- `set selected`: Устанавливает состояние выбора карточки
- `set title`: Устанавливает заголовок карточки
- `set image`: Устанавливает изображение
- `set description`: Устанавливает описание
- `set category`: Устанавливает категорию
- `set price`: Устанавливает цену

## CatalogItem extends Card

Класс `CatalogItem` расширяет функционал класса Card, добавляя возможность установки статуса категории товара и его отображения.

#### Основные методы и свойства:

- `setCategoryStatus({ category, label })`: Устанавливает категорию товара и применяет соответствующий стиль на основе категории.
  `category`: Категория товара
  `label`: Метка категории товара

---

## Класс Form extends Component

Представляет форму с полями ввода, а также содержит логику для обработки ввода и отправки формы

#### Методы

- `onInputChange`: Обрабатывает событие изменения ввода в поле формы
- `set valid`: Устанавливает состояние активности кнопки отправки формы в зависимости от валидности формы
- `set errors`: Устанавливает текст ошибки для отображения пользователю
- `clearFields`: Очищает все поля формы
- `render`: Обновляет отображение формы в соответствии с переданным состоянием, включая валидность и ошибки

---

## Класс Order extends Form

Класс `Order` представляет собой форму заказа с полями для указания адреса доставки и выбора способа оплаты. Он расширяет функциональность класса `Form` и добавляет возможность выбора способа оплаты.

#### Методы:

**constructor**: `Order(container: HTMLFormElement, events: IEvents)` : Вызывает конструктор класса Form, передавая ему контейнер и объект событий.
Инициализирует кнопки для выбора типа оплаты (`_card` и `_cash`).

- `_card`: HTML-элемент кнопки для выбора оплаты картой.
- `_cash`: HTML-элемент кнопки для выбора оплаты наличными.

- `disableButtons`: Метод для отключения подсветки кнопок выбора способа оплаты.

---

## Класс Contacts extends Form

Класс `Contacts` используется для управления формой контактов.

**constructor**: `Contacts(container: HTMLFormElement, events: IEvents)`:
**Параметры**

- `container`: HTML-форма, представляющая контейнер для формы контактов.
- `events`: Объект событий для обработки событий в приложении.
  Вызывает конструктор класса `Form`, передавая ему контейнер и объект событий.

---

## Класс Modal

Предоставляет интерфейс для отображения и управления модальным окном, позволяет устанавливать его содержимое, открывать и закрывать окно, а также реагировать на события открытия и закрытия модального окна.

#### Свойства

- `_closeButton`: Кнопки закрытия модального окна
- `_content`: Содержимое модального окна

#### Методы

- `set content`: Устанавливает содержимое модального окна
- `open`: Открывает модальное окно, добавляя класс `modal_active` и генерируя событие `modal:open`
- `close`: Закрывает модальное окно, удаляя класс `modal_active`, очищая содержимое и генерируя событие `modal:close`
- `render`: Отображает модальное окно с заданными данными

---

## Класс Success extends Component

Предоставляет способ отображения сообщений об успешном завершении операции

#### Свойства

- `_button`: Кнопка закрытия сообщения
- `_description`: Описание сообщения

#### Методы

- `constructor(blockName: string, container: HTMLElement, actions?: ISuccessActions):`:

  - `blockName` : Название блока
  - `container`: Корневой элемент, представляющий контейнер сообщения
  - `actions`: Объект событий, содержащий обработчик клика на кнопке закрытия

- `set description`: устанавливает текст описания успешной операции с помощью функции `handlePrice` из утилиты `utils`.

---

## Класс Tabs extends Component

Обеспечивает управление состоянием и поведением вкладок в интерфейсе, а также предоставляет возможность реагировать на действия пользователя.

#### Свойства

- `_buttons` : Массив кнопок (вкладки).

#### Дополнительные типы

- `TabState` : Описывает состояние вкладок и содержит свойство selected, указывающее на имя выбранной вкладки
- `TabActions`: Определяет доступные действия для вкладок и содержит функцию onClick, вызываемую при щелчке на вкладке и принимающую имя выбранной вкладки

#### Методы

- `set selected`: Устанавливает выбранную вкладку путем добавления класса `tabs__item_active` и блокировки кнопки при совпадении имени вкладки с переданным именем

---

## Events

Брокера событий (EventEmitter), который позволяет подписываться на события, инициировать события и снимать подписку событий.

#### Интерфейс IEvents

- `on`: Метод для подписки на событие. Принимает имя события и колбэк для обработки события
- `emit`: Метод для инициирования события. Принимает имя события и данные, которые будут переданы обработчикам
- `trigger`: Метод для создания триггера, который генерирует событие при вызове. Позволяет передавать контекстные данные для события

### Класс EventEmitter

#### Методы

- `on`: Метод для подписки на событие. Добавляет колбэк в список обработчиков для указанного события
- `off`: Метод для отписки от события. Удаляет указанный колбэк из списка обработчиков для указанного события=
- `emit`: Метод для инициирования события. Вызывает все обработчики для указанного события, передавая им данные
- `onAll`: Метод для подписки на все события. Позволяет прослушивать все события
- `offAll`: Метод для отписки от всех событий. Очищает все обработчики событий
- `trigger`: Метод для создания триггера. Возвращает функцию, которая инициирует указанное событие с переданными данными

---

## Modal

Этот базовый класс `Model`предоставляет удобный способ управления данными и уведомлением об изменениях в них

#### Методы

- `emitChanges`: Инициирует событие, уведомляя окружающий код о том, что модель изменилась, и передает опциональные данные

Функция `isMode`: Проверяет, является ли переданный объект экземпляром класса `Model`, является гвардом типа

---

## Класс AppState extends Model

Класс, описывающий состояние приложения и предоставляет методы для управления им.

### Основные методы и свойства:

- `basket`: Массив товаров, добавленных в корзину.
- `catalog`: Массив всех товаров в каталоге.
- `loading`: Флаг, указывающий на состояние загрузки данных.
- `order`: Информация о заказе, включая email, телефон, список выбранных товаров, общую сумму, адрес и способ оплаты.
- `preview`: ID товара, выбранного для предварительного просмотра.
- `formErrors`: Объект с ошибками валидации формы.
- `toggleOrderedLot()`: Метод для добавления или удаления товара из заказа.
- `getTotal()`: Метод для расчета общей стоимости заказа.
- `clearBasket()`: Метод для очистки корзины.
- `setCatalog()`: Метод для установки каталога товаров.
- `setPreview()`: Метод для установки предварительного просмотра товара.
- `setOrderField()`: Метод для установки значений полей заказа и запуска валидации.
- `validateOrder()`: Метод для валидации информации о заказе.
- `validateContactInfo()`: Метод для валидации контактной информации.
- `addToBasket()`: Метод для добавления товара в корзину.
- `getBasketAmount()`: Метод для получения количества товаров в корзине.
- `getTotalBasketPrice()`: Метод для расчета общей стоимости товаров в корзине.
- `deleteFromBasket()`: Метод для удаления товара из корзины.
- `setItems()`: Метод для установки товаров из корзины в заказ.
- `refreshOrder()`: Метод для обновления информации о заказе, сбрасывая все значения в исходное состояние.

---

## Класс API

Предназначен для облегчения взаимодействия с удаленным API в приложении

#### Типы

- `ApiListResponse`: Определяет структуру ответа от API, содержащую общее количество элементов и сами элементы определенного типа
- `ApiPostMethods`: Перечисление возможных методов запроса для POST-запросов (POST, PUT, DELETE)

#### Методы

- `handleResponse`: Обрабатывает ответ от сервера: если ответ успешный, возвращает данные в формате JSON, иначе выбрасывает ошибку с сообщением об ошибке
- `get`: Выполняет HTTP GET-запрос к указанному ресурсу и возвращает промис с данными из ответа
- `post`: Выполняет HTTP POST-запрос к указанному ресурсу с переданными данными и методом и возвращает промис с данными из ответа

---

## AuctionAPI extends Api

Класс AuctionAPI использует базовый класс Api для выполнения HTTP-запросов к API.
Преобразование данных происходит в методах getLotList и getLotItem.

#### Интерфейс IAuctionAPI

- `getLotList`: Определяет метод для получения списка товаров.
- `getLotItem`: Определяет метод для получения конкретного товара по id.
- `orderLots`: Определяет метод для оформления заказа товара

#### Методы

- `getLotList`: Выполняет HTTP GET-запрос для получения списка товаров.
  Возвращает промис, разрешающийся массивом объектов типа ILotItem
- `getLotItem`: Выполняет HTTP GET-запрос для получения конкретного товара по ID.
  Возвращает промис, разрешающийся объектом типа ILotItem.
- `orderLots`: Выполняет HTTP POST-запрос для оформления заказа.
  Возвращает промис, разрешающийся объектом типа IOrderResult

---
